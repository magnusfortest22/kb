name: Copy files from 'en' to 'ru' and 'zh' on changes

on:
  push:
    paths:
      - 'en/**'  # Trigger the action on changes in the 'en' directory
  pull_request:
    paths:
      - 'en/**'  # Trigger the action for PRs on changes in 'en' directory

jobs:
  copy-files:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Configure Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: Copy files from 'en' to 'ru' and 'zh'
      run: |
        # Ensure the 'ru' and 'zh' directories exist
        mkdir -p ru
        mkdir -p zh
        
        # Copy all files from 'en' directory to 'ru'
        cp -r en/* ru/
        
        # Copy all files from 'en' directory to 'zh'
        cp -r en/* zh/

    - name: Commit changes
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # Stage the copied files from 'en' to 'ru' and 'zh'
        git add ru/* zh/*

        # Commit changes if any
        git diff --cached --quiet || git commit -m "Copy files from 'en' to 'ru' and 'zh' directories"
        
        # Pull the latest changes from the remote branch before pushing
        git pull origin main --rebase

        # Push the updated code to the main branch
        git push origin main
