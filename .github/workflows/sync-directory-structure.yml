name: Sync Directory Structure

on:
  push:
    paths:
      - "en/**"

jobs:
  sync-structure:
    name: Sync Directory Structure
    runs-on: ubuntu-latest
    needs: sync-translation-only-updated-files

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Sync directory structure
        run: |
          # Directories to sync
          LANG_DIRS=("ru" "zh")

          # Sync structure for each language directory
          for LANG in "${LANG_DIRS[@]}"; do
            # Ensure all files and directories in 'en' exist in the target directory
            rsync -av --exclude=".git" --include="*/" --exclude="*" en/ "$LANG/"
            
            # Remove files/directories in the target directory that no longer exist in 'en'
            rsync -av --delete --exclude=".git" --include="*/" --exclude="*" en/ "$LANG/"
          done

      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # Check for changes and commit
          if [ -n "$(git status --porcelain)" ]; then
            git add .
            git commit -m "Sync directory structure to match 'en'"
            git push --set-upstream origin $(git rev-parse --abbrev-ref HEAD)
          else
            echo "No changes to commit."
